# Rembg èƒŒæ™¯ç§»é™¤æœåŠ¡å™¨

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº FastAPI æ„å»ºçš„è½»é‡çº§ Web æœåŠ¡å™¨ï¼Œå®ƒå°è£…äº†å¼ºå¤§çš„ [rembg](https://github.com/danielgatis/rembg) åº“ï¼Œè®©æ‚¨å¯ä»¥é€šè¿‡ç®€å•çš„ API è°ƒç”¨æ¥ç§»é™¤å›¾åƒèƒŒæ™¯ã€‚

ç»æµ‹è¯•ï¼Œæœ¬æœåŠ¡åœ¨ **2 æ ¸ CPU å’Œ 2GB å†…å­˜** çš„æœåŠ¡å™¨ä¸Šå³å¯æµç•…è¿è¡Œã€‚

æˆ‘ä»¬è¿˜å¼€å‘äº†ä¸€æ¬¾é…å¥—çš„æµè§ˆå™¨æ’ä»¶ [Banana Peel](https://github.com/Yorick-Ryu/BananaPeel)ï¼Œè®©æ‚¨å¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šå³é”®ç‚¹å‡»å›¾ç‰‡ç§»é™¤èƒŒæ™¯ï¼Œæ¬¢è¿ä½“éªŒã€‚

[English](./README.md)

## ä½¿ç”¨æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¸è¿è¡Œ

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®‰è£…å¹¶è¿è¡Œæœ¬æœåŠ¡ã€‚

#### æ–¹æ³•ä¸€ï¼šæœ¬åœ°è¿è¡Œ

1.  å°†æ­¤ä»£ç ä»“åº“å…‹éš†åˆ°æ‚¨çš„æœ¬åœ°è®¡ç®—æœºï¼š
    ```bash
    git clone https://github.com/Yorick-Ryu/rembg-server.git
    cd rembg-server
    ```
2.  å®‰è£…æ‰€éœ€çš„ä¾èµ–åº“ï¼š
    ```bash
    pip install rembg[cpu,cli]
    ```
3.  å¯åŠ¨æœåŠ¡ï¼š
    ```bash
    python main.py
    ```
    æœåŠ¡å°†é»˜è®¤åœ¨ `7001` ç«¯å£å¯åŠ¨ã€‚

#### æ–¹æ³•äºŒï¼šä½¿ç”¨ Docker éƒ¨ç½²

1.  ä» `ghcr.io` æ‹‰å–é¢„æ„å»ºçš„ Docker é•œåƒï¼š
    ```bash
    docker pull ghcr.io/yorick-ryu/rembg-server:latest
    ```

2.  è¿è¡Œ Docker å®¹å™¨ï¼š
    ```bash
    docker run -d --name rembg-service -p 7001:7001 ghcr.io/yorick-ryu/rembg-server:latest
    ```

    å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£ï¼ˆä¾‹å¦‚ `8080`ï¼‰ï¼Œå¯ä»¥è¿™æ ·è¿è¡Œï¼š
    ```bash
    docker run -d -p 8080:8080 -e PORT=8080 --name rembg-service ghcr.io/yorick-ryu/rembg-server:latest
    ```

### ç¬¬äºŒæ­¥ï¼šé…ç½®æ¨¡å‹

æœåŠ¡é€šè¿‡ `models.json` æ–‡ä»¶æ¥ç®¡ç†å’Œé…ç½®å¯ç”¨çš„ AI æ¨¡å‹ã€‚

- **models**: ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å‹é…ç½®çš„æ•°ç»„ã€‚æ¯ä¸ªé…ç½®éƒ½åŒ…å«æ¨¡å‹çš„ `name`ï¼ˆåç§°ï¼‰ã€`desc`ï¼ˆæè¿°ï¼‰å’Œ `enabled`ï¼ˆæ˜¯å¦å¯ç”¨ï¼‰å­—æ®µã€‚
- **default_model**: å½“ API è¯·æ±‚æœªæŒ‡å®šæ¨¡å‹æ—¶ï¼Œå°†ä½¿ç”¨æ­¤é»˜è®¤æ¨¡å‹ã€‚

`models.json` ç¤ºä¾‹ï¼š
```json
{
  "models": [
    {
      "name": "u2net",
      "desc": "é€šç”¨æ¨¡å‹",
      "enabled": false
    },
    {
      "name": "silueta",
      "desc": "è½»é‡çº§é€šç”¨æ¨¡å‹",
      "enabled": true
    },
    {
      "name": "isnet-general-use",
      "desc": "é€šç”¨æ¨¡å‹",
      "enabled": true
    },
    {
      "name": "isnet-anime",
      "desc": "åŠ¨æ¼«ä¸“ç”¨æ¨¡å‹",
      "enabled": true
    }
  ],
  "default_model": "silueta"
}
```
**æ³¨æ„**ï¼šåªæœ‰ `enabled` è®¾ç½®ä¸º `true` çš„æ¨¡å‹æ‰ä¼šè¢«åŠ è½½å¹¶å¯ä»¥é€šè¿‡ API ä½¿ç”¨ã€‚

### ç¬¬ä¸‰æ­¥ï¼šé…åˆæµè§ˆå™¨æ’ä»¶ä½¿ç”¨

ä¸ºäº†æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥é…åˆæˆ‘ä»¬çš„æµè§ˆå™¨æ’ä»¶ [Banana Peel](https://github.com/Yorick-Ryu/BananaPeel) ä¸€èµ·ä½¿ç”¨ã€‚

1.  è®¿é—® [Banana Peel](https://github.com/Yorick-Ryu/BananaPeel) é¡¹ç›®é¡µé¢ï¼Œæ ¹æ®è¯´æ˜å®‰è£…æ’ä»¶ã€‚
2.  å®‰è£…åï¼Œç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„æ’ä»¶å›¾æ ‡ï¼Œåœ¨è®¾ç½®ä¸­å¡«å…¥æ‚¨çš„æœåŠ¡å™¨åœ°å€ï¼ˆä¾‹å¦‚ `http://127.0.0.1:7001`ï¼‰ã€‚

é…ç½®å®Œæˆåï¼Œæ‚¨å°±å¯ä»¥åœ¨ä»»æ„ç½‘é¡µä¸Šé€šè¿‡å³é”®èœå•å¿«é€Ÿç§»é™¤å›¾ç‰‡èƒŒæ™¯äº†ã€‚

## API æ–‡æ¡£

æœåŠ¡å¯åŠ¨åï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¿é—® `/docs` æˆ– `/redoc` è·¯å¾„æ¥æŸ¥çœ‹ç”± FastAPI è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼ API æ–‡æ¡£ã€‚

### GET /

æ­¤æ¥å£ç”¨äºæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œä¼šè¿”å›ä¸€æ¡æ¬¢è¿ä¿¡æ¯ã€‚

- **æ–¹æ³•**: `GET`
- **URL**: `/`

#### å“åº”ç¤ºä¾‹

```json
{
  "message": "æ¬¢è¿ä½¿ç”¨ rembg èƒŒæ™¯ç§»é™¤æœåŠ¡å™¨ã€‚"
}
```

### GET /models

è·å–å½“å‰æ‰€æœ‰å·²å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨ã€‚

- **æ–¹æ³•**: `GET`
- **URL**: `/models`

#### ä½¿ç”¨ cURL è¯·æ±‚ç¤ºä¾‹

```bash
curl http://your-server-ip:7001/models
```

#### å“åº”ç¤ºä¾‹

```json
{
  "models": [
    {
      "name": "silueta",
      "desc": "è½»é‡çº§é€šç”¨"
    },
    {
      "name": "isnet-general-use",
      "desc": "é€šç”¨"
    },
    {
      "name": "isnet-anime",
      "desc": "åŠ¨æ¼«"
    }
  ]
}
```

#### å¯ç”¨æ¨¡å‹åˆ—è¡¨

æœ¬é¡¹ç›®æ”¯æŒ `rembg` åº“ä¸­çš„æ‰€æœ‰æ¨¡å‹ï¼ˆè¶…è¿‡15ç§ï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚è¦æŸ¥çœ‹å®Œæ•´çš„æ¨¡å‹åˆ—è¡¨ã€åŠŸèƒ½æè¿°å’Œæ•ˆæœå¯¹æ¯”ï¼Œè¯·è®¿é—® `rembg` å®˜æ–¹æ–‡æ¡£ï¼š

**ğŸ“‹ [æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¨¡å‹](https://github.com/danielgatis/rembg?tab=readme-ov-file#models)**

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨æ¨¡å‹ï¼š
- `u2net` - é€šç”¨çš„èƒŒæ™¯ç§»é™¤æ¨¡å‹ã€‚
- `silueta` - è½»é‡çº§æ¨¡å‹ï¼Œå¤„ç†é€Ÿåº¦å¿«ï¼ˆä»…43MBï¼‰ã€‚
- `isnet-anime` - é’ˆå¯¹åŠ¨æ¼«å’Œå¡é€šé£æ ¼å›¾ç‰‡ä¼˜åŒ–çš„é«˜ç²¾åº¦æ¨¡å‹ã€‚
- `birefnet-portrait` - ä¸“ä¸ºäººåƒåˆ†å‰²è®¾è®¡çš„æ¨¡å‹ã€‚
- `sam` - åŠŸèƒ½å¼ºå¤§çš„é«˜çº§æ¨¡å‹ï¼Œé€‚ç”¨äºå„ç§å¤æ‚åœºæ™¯ã€‚

### POST /remove

è¿™æ˜¯æ ¸å¿ƒçš„èƒŒæ™¯ç§»é™¤æ¥å£ã€‚

- **æ–¹æ³•**: `POST`
- **URL**: `/remove`
- **Content-Type**: `multipart/form-data`
- **è¡¨å•æ•°æ®**:
  - `file`: éœ€è¦å¤„ç†çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰ã€‚
  - `model`: ç”¨äºå¤„ç†çš„æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º `default_model` ä¸­é…ç½®çš„æ¨¡å‹ï¼‰ã€‚è¯¥æ¨¡å‹å¿…é¡»åœ¨ `models.json` ä¸­å·²å¯ç”¨ã€‚

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-----------|------|----------|---------|-------------|
| `file` | File | æ˜¯ | - | å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚ JPG, PNG, WebP ç­‰ï¼‰ |
| `model` | String | å¦ | `silueta` | ç”¨äºèƒŒæ™¯ç§»é™¤çš„æ¨¡å‹åç§° |

#### å“åº”

- **æˆåŠŸ**: è¿”å›å¤„ç†åçš„ PNG æ ¼å¼å›¾ç‰‡ã€‚
- **å¤±è´¥**: è¿”å›åŒ…å«é”™è¯¯ä¿¡æ¯çš„ JSON æ•°æ®ã€‚

#### ä½¿ç”¨ cURL è¯·æ±‚ç¤ºä¾‹

**1. ä½¿ç”¨é»˜è®¤æ¨¡å‹ (`silueta`):**

```bash
curl -X POST \
  -F "file=@/path/to/your/image.jpg" \
  http://your-server-ip:7001/remove \
  -o output.png
```

**2. æŒ‡å®š `isnet-anime` æ¨¡å‹å¤„ç†åŠ¨æ¼«å›¾ç‰‡:**

```bash
curl -X POST \
  -F "file=@/path/to/your/anime-image.jpg" \
  -F "model=isnet-anime" \
  http://your-server-ip:7001/remove \
  -o output_anime.png
```

**3. ä½¿ç”¨ `isnet-general-use` æ¨¡å‹å¤„ç†é€šç”¨å›¾ç‰‡:**

```bash
curl -X POST \
  -F "file=@/path/to/your/image.jpg" \
  -F "model=isnet-general-use" \
  http://your-server-ip:7001/remove \
  -o output_general.png
```

#### é”™è¯¯å“åº”ç¤ºä¾‹

å¦‚æœè¯·æ±‚äº†æ— æ•ˆæˆ–æœªå¯ç”¨çš„æ¨¡å‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯ï¼š

```json
{
  "detail": "æ¨¡å‹ 'invalid-model' ä¸å¯ç”¨æˆ–æœªå¯ç”¨ã€‚å¯ç”¨æ¨¡å‹: ['silueta', 'isnet-general-use', 'isnet-anime']"
}
```

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [@danielgatis](https://github.com/danielgatis) åˆ›å»ºçš„å‡ºè‰²é¡¹ç›® [rembg](https://github.com/danielgatis/rembg) æ„å»ºã€‚æˆ‘ä»¬è¡·å¿ƒæ„Ÿè°¢ `rembg` çš„ä½œè€…å’Œæ‰€æœ‰è´¡çŒ®è€…ï¼Œä»–ä»¬è®©å¼ºå¤§çš„ AI å›¾åƒå¤„ç†æŠ€æœ¯å˜å¾—è§¦æ‰‹å¯åŠã€‚

**ğŸ™ ç‰¹åˆ«æ„Ÿè°¢:**
- [danielgatis/rembg](https://github.com/danielgatis/rembg) - æ ¸å¿ƒèƒŒæ™¯ç§»é™¤åº“ã€‚
- `rembg` ç¤¾åŒºå’Œæ‰€æœ‰è´¡çŒ®è€…ã€‚
- æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®æä¾›æ”¯æŒçš„ AI æ¨¡å‹ï¼ˆå¦‚ UÂ²-Net, IS-Net, BiRefNet, SAM ç­‰ï¼‰çš„ç ”ç©¶äººå‘˜ã€‚
